:toc:

= Cypher Directive Test

== Schema

[source,graphql,schema=true]
----
type Role @relation(name:"ACTED_IN", from:"actor", to:"movie") {
   actor: Person
   movie: Movie
   roles: [String]
   type: String @cypher(statement:"""
     RETURN type(this)
     """)
}

type Person {
  name: String
  born: Int
  roles: [Role]
  _all: String
  _id: ID!
}

type Movie {
  title: String
  released: Int
  characters: [Role]
  _all: String
  _id: ID!
  _labels: [String] @cypher(statement:"""
  RETURN labels(this)
  """)
}

----

== Queries

=== Simple Cypher Directive on Field

.GraphQL-Query
[source,graphql]
----
query {
  person(first: 1) {
    roles {
      type
    }
  }
}
----

.Cypher Params
[source,json]
----
{}
----

.Cypher
[source,cypher]
----
MATCH (person:Person)
RETURN person {
	roles: [(person)-[personRoles:ACTED_IN]->(personRolesMovie:Movie) | personRoles {
		type: apoc.cypher.runFirstColumnSingle('WITH $this AS this RETURN type(this)',  {
			this: personRoles
		})
	}]
} AS person LIMIT $personFirst
----
